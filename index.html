<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#6a11cb,#2575fc);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}
.box{
  background:#fff;
  padding:20px;
  width:360px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}
h2{text-align:center}
input,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  background:#2575fc;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{opacity:.9}
.dashboard{display:none}
.link{color:#2575fc;cursor:pointer}
</style>
</head>

<body>

<div class="box">

  <!-- ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„ -->
  <div id="auth">
    <h2>MaliApp</h2>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="register()">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</button>
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <p id="msg"></p>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app" class="dashboard">
    <h2>Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ðŸŽ‰</h2>
    <p>Ø±ØµÙŠØ¯Ùƒ: <b><span id="balance">0</span></b> ðŸ’°</p>
    <p>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©:</p>
    <p class="link" id="refLink"></p>

    <button onclick="addTask()">Ø¥Ù†Ø¬Ø§Ø² Ù…Ù‡Ù…Ø© (+10)</button>
    <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>

</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ðŸ”¥ Firebase config (Ù…ØªØ§Ø¹Ùƒ)
const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
  storageBucket: "maliapp-63f91.appspot.com",
  messagingSenderId: "901870433172",
  appId: "1:901870433172:web:325b2312af72099279d581"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

// ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨
function register(){
  const email = email.value;
  const password = password.value;

  auth.createUserWithEmailAndPassword(email,password)
  .then(user=>{
    db.collection("users").doc(user.user.uid).set({
      balance:0,
      referral:user.user.uid.slice(0,6)
    });
    showApp();
  })
  .catch(err=>msg.innerText=err.message);
}

// Ø¯Ø®ÙˆÙ„
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(showApp)
  .catch(err=>msg.innerText=err.message);
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
function showApp(){
  auth.onAuthStateChanged(user=>{
    if(user){
      document.getElementById("auth").style.display="none";
      document.getElementById("app").style.display="block";

      db.collection("users").doc(user.uid).get().then(doc=>{
        balance.innerText = doc.data().balance;
        refLink.innerText =
        location.origin+"?ref="+doc.data().referral;
      });
    }
  });
}

// Ù…Ù‡Ù…Ø©
function addTask(){
  const user = auth.currentUser;
  const ref = db.collection("users").doc(user.uid);
  ref.update({balance:firebase.firestore.FieldValue.increment(10)})
  .then(()=>showApp());
}

// Ø®Ø±ÙˆØ¬
function logout(){
  auth.signOut().then(()=>location.reload());
}
</script>

</body>
</html>
