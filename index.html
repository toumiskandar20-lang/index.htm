<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>MaliApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #2575fc;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.box {
  background: white;
  padding: 20px;
  border-radius: 12px;
  width: 350px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
}
button {
  background: #28a745;
  color: white;
  border: none;
  border-radius: 6px;
}
.dashboard { display: none; }
</style>
</head>

<body>

<div class="box">
  <h2>MaliApp</h2>

  <!-- ØªØ³Ø¬ÙŠÙ„ -->
  <div id="auth">
    <input id="email" type="email" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ ØµØ­ÙŠØ­">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±">
    <button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="dashboard" id="dashboard">
    <p>Ø±ØµÙŠØ¯Ùƒ: <span id="balance">0</span> ðŸ’°</p>
    <p>Ø±Ø§Ø¨Ø·Ùƒ: <span id="ref"></span></p>
    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91",
  storageBucket: "maliapp-63f91.appspot.com",
  messagingSenderId: "901870433172",
  appId: "1:901870433172:web:325b2312af72099279d581"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ØªØ³Ø¬ÙŠÙ„
window.register = async () => {
  const email = email.value;
  const password = password.value;

  const userCred = await createUserWithEmailAndPassword(auth, email, password);
  const uid = userCred.user.uid;

  const refCode = Math.floor(Math.random() * 100000);

  await setDoc(doc(db, "users", uid), {
    email,
    balance: 0,
    referral: refCode
  });

  alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ…");
};

// Ø¯Ø®ÙˆÙ„
window.login = async () => {
  const userCred = await signInWithEmailAndPassword(auth, email.value, password.value);
  const uid = userCred.user.uid;

  const snap = await getDoc(doc(db, "users", uid));
  const data = snap.data();

  document.getElementById("auth").style.display = "none";
  document.getElementById("dashboard").style.display = "block";
  balance.innerText = data.balance;
  ref.innerText = "https://maliapp.com/ref=" + data.referral;
};

// Ø®Ø±ÙˆØ¬
window.logout = async () => {
  await signOut(auth);
  location.reload();
};
</script>

</body>
</html>
